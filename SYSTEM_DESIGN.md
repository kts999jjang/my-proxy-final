# 앱 개발 목표 및 시스템 동작 시퀀스

## 1. 앱의 개발 목표 (The Goal)

이 앱의 핵심 목표는 **"최신 뉴스 데이터를 기반으로, 현재 시장에서 가장 주목받는 투자 테마와 관련된 유망 주식을 발굴하여 사용자에게 추천하는 것"** 입니다.

이를 위해 다음과 같은 세부 목표를 가집니다.

-   **자동화된 분석**: 매일 자동으로 최신 뉴스를 수집하고, 자연어 처리(NLP)와 AI 임베딩 기술을 통해 시장의 트렌드를 분석합니다.
-   **객관적인 점수화**: 뉴스 언급 빈도, 애널리스트 평가, 내부자 거래 동향 등 여러 지표를 종합하여 각 주식의 잠재력을 객관적인 점수로 평가합니다.
-   **직관적인 정보 제공**: 최종적으로 선정된 추천 종목을 '주도주'와 '성장주'로 구분하여 사용자에게 보여주고, 각 종목이 왜 추천되었는지 상세 분석 리포트를 통해 투명하게 공개합니다.
-   **데이터 투명성**: 사용자가 직접 데이터 대시보드를 통해 어떤 데이터가 수집되고 분석되었는지 확인할 수 있도록 합니다.

---

## 2. 시스템 동작 시퀀스 (The Sequence)

우리 시스템은 크게 **"데이터 수집"**, **"데이터 분석"**, 그리고 **"데이터 제공"** 이라는 세 단계의 시퀀스로 동작합니다.

### 1단계: 데이터 수집 (Data Population) - `populate_index.js`

*   **실행 주기**: 매일 정해진 시간에 자동으로 실행됩니다. (현재 Render Cron Job으로 설정)
*   **동작 순서**:
    1.  `constants.js`에 정의된 투자 테마(인공지능, 전기차 등) 목록을 가져옵니다.
    2.  각 테마별로 GNews API를 호출하여, 지난 7일간의 관련 뉴스 기사(제목, URL, 출처 등)를 수집합니다.
    3.  수집된 각 기사에 '어떤 테마의 뉴스인지'를 나타내는 `theme` 메타데이터를 추가합니다.
    4.  Gemini 임베딩 모델을 사용하여 각 기사 **제목**의 의미를 벡터(숫자 배열)로 변환합니다.
    5.  변환된 벡터와 기사의 메타데이터(제목, URL, 출처, 테마)를 한 쌍으로 묶어 **Pinecone 벡터 데이터베이스**에 저장(upsert)합니다.
    6.  수집된 뉴스의 전체 기간(가장 오래된 날짜 ~ 최신 날짜)을 계산하여 **Redis**에 저장합니다.

> **결과물**: Pinecone DB에는 최신 뉴스 기사들이 의미 벡터와 함께 저장됩니다.

### 2단계: 데이터 분석 (Analysis) - `run_analysis.js`

*   **실행 주기**: `populate_index.js` 실행 후, 매일 정해진 시간에 자동으로 실행됩니다.
*   **동작 순서**:
    1.  `constants.js`의 투자 테마 목록을 가져옵니다.
    2.  각 테마별로, **테마 쿼리** (예: `"artificial intelligence" OR "semiconductor" ...`) 자체를 Gemini를 통해 벡터로 변환합니다.
    3.  이 '테마 벡터'와 의미적으로 가장 유사한 뉴스 기사들을 Pinecone에서 검색합니다. (이때 `theme` 필터를 사용하여 정확도를 높입니다.)
    4.  검색된 기사들의 제목에서 `compromise-nlp`를 이용해 회사 이름을 추출하고, 언급 빈도를 계산합니다.
    5.  추출된 회사 이름을 Finnhub API로 조회하여 주식 티커를 찾습니다. (이 정보는 Redis에 캐싱하여 재사용합니다.)
    6.  언급 빈도가 높은 상위 종목들을 '분석 후보'로 선정합니다.
    7.  각 후보 종목에 대해 Finnhub API를 호출하여 애널리스트 평가, 내부자 거래, 재무 정보 등 상세 데이터를 가져와 종합 점수를 계산합니다.
    8.  GNews 기사 제목을 기반으로 로컬에서 '뉴스 감성 점수'를 계산하여 최종 점수에 반영합니다.
    9.  일정 점수 이상인 종목들을 '주도주'와 '성장주'로 분류하여 최종 추천 목록을 생성합니다.
    10. 이 최종 추천 결과를 **Redis**에 `latest_recommendations`라는 키로 저장합니다.

> **결과물**: Redis에는 오늘의 추천 종목 목록이 테마별/스타일별로 분류되어 저장됩니다.

### 3단계: 데이터 제공 (Serving) - `server.js` & Flutter App

*   **실행 주기**: 사용자가 앱을 실행하거나 상세 정보를 요청할 때마다 실시간으로 동작합니다.
*   **동작 순서**:
    1.  **앱 실행**: Flutter 앱이 실행되면, `server.js`의 `/api/themes` 엔드포인트를 호출합니다.
    2.  **추천 목록 조회**: 서버는 Redis에 저장된 `latest_recommendations` 데이터를 읽어 앱에 전달합니다. 앱은 이 데이터를 화면에 표시합니다.
    3.  **상세 리포트 조회**: 사용자가 특정 종목을 클릭하면, 앱은 해당 종목의 `티커`와 `테마` 정보를 담아 `/api/details` 엔드포인트를 호출합니다.
    4.  **상세 정보 생성**: 서버는 `run_analysis.js`와 **동일한 방식**(테마 쿼리 임베딩)으로 Pinecone에서 관련 뉴스를 다시 검색하고, Yahoo Finance API로 주가 정보를 가져와 상세 분석 리포트 데이터를 생성하여 앱에 전달합니다.
    5.  **대시보드 조회**: 사용자가 웹 브라우저로 `/dashboard`에 접속하면, 서버는 `public/dashboard.html` 파일을 제공하고, 관련 API들은 Pinecone과 Redis의 현재 상태를 보여줍니다.

> **결과물**: 사용자는 앱을 통해 항상 최신 분석 결과를 볼 수 있으며, 각 종목의 상세한 추천 근거를 확인할 수 있습니다.


# 항상 대답은 한글로 해줘
